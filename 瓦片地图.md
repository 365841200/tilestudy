# 瓦片地图

* 目前地图服务大多数都是基于栅格（瓦片）模型的地图服务，比如百度地图或者谷歌地图，对于某一块地方的描述，都是通过10多层乃至20多层不同分辨率的图片所组成的，当用户进行缩放时，根据缩放的级数，选择不同分辨率的瓦片图拼接成一幅完整的地图（一般公开服务，瓦片图都是从服务器上下载的）
* 对于矢量模型的电子地图来说，由于所有的数据以矢量的方式存放管理，事实上图层是一个比较浅薄的概念，因为任何地图元素和数据都可以根据需要自由分类组成，或者划分成不同的图层，各种图层之间关系可以很复杂，例如可以将所有的道路数据做成一个图层，也可以将主干道做成一个图层，支路做成另外一个图层。图层中数据归类和组合比较自由。
* 对于栅格模型（瓦片图），图层的概念就很重要，由于图层是生成制作出来，每个图层内包含的元素相对是固化的，因此要引入底图的概念：一个包含了最基本、最常用的地图数据元素的图层，例如：道路、河流、桥梁、绿地，甚至有些底图会包含建筑物或者其他地物的轮廓。在底图的基础上，可以叠加各种我们需要的图层，满足应用需要，例如：道路堵车状况的图层，卫星图，POI图层等等。底图通常是通过选取必要地图矢量数据项，然后通过地图美工的工作，设定颜色，字体，显示方式，显示规则等等，然后渲染得到了（通常会渲染出一整套不同分辨率的瓦片地图）

>底图数据：来源于3种
>>官方地图：官方地图一般来源于政府相关部门的权威测绘和发布。</br>
实地外采：实际环境中测绘得到</br>
航片卫片制作：通过自己拍摄或购买的高精度航空照片或卫星照片或遥感照片，在此作为底片的基础上进行人为的矢量标注和勾勒，形成矢量数据。

## 瓦片服务

1. WMTS(Web Map Tile Service)</br>WMTS提供了一种采用预定义图块方法发布数字地图服务的标准化解决方案。WMTS弥补了WMS不能提供分块地图的不足。WMS针对提供可定制地图的服务，是一个动态数据或用户定制地图(需结合SLD标准)的理想解决办法。WMTS牺牲了提供定制地图的灵活性，代之以通过提供静态数据(基础地图)来增强伸缩性，这些静态数据的范围框和比例尺被限定在各个图块内。这些固定的图块集使得对WMTS服务的实现可以使用一个仅简单返回已有文件的web服务器即可，同时使得可以利用一些标准的诸如分布式缓存的网络机制实现伸缩性。
2. WMS(Web Map Service)</br>能够根据用户的请求返回相应的地图(包括PNG,GIF,JPEG等栅格形式或是SVG和WEB CGM等矢量形式)。WMS支持网络协议HTTP，所支持的操作是由URL定义的。
3. WFS(Web Feature Service)</br>支持对地理要素的插入，更新，删除，检索和发现服务。该服务根据HTTP客户请求返回GML(Geography Markup Language、地理标识语言)数据。WFS对应于常见桌面程序中的条件查询功能，WFS通过OGC Filter构造查询条件，支持基于空间几何关系的查询，基于属性域的查询，当然还包括基于空间关系和属性域的共同查询。
4. WCS(Web Coverage Service)</br>网络覆盖服务是面向空间影像数据，包含地理位置的地理空间数据作为"覆盖(Coverage)"在网上相互交换，如卫星影像、数字高程数据等栅格数据。

### WMTS

* WMTS请求URL示例

><http://t6.tianditu.cn/img_c/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=img&tileMatrixSet=c&TileMatrix=2&TileRow=0&TileCol=1&style=default&format=tiles>

* img_c：img是卫星影像，'_c'指经纬度投影</br>TileMatrix：瓦片级别</br>TileRow：行号</br>TileCol：列号

## 瓦片切分规则

* 不同的地图瓦片切分起起始点不一定是左上角，相反很多地图厂商会从左下角，目前从右侧作为起点切分的比较少见。瓦片行列号的计算，首先需要确定地图级别，二维地图比较简单，每次放大或者缩小地图级别相应的增加或者减少，对于三维地图，渲染窗口同时显示的地图级别不一样，这是根据视点(人眼的位置)到目标点的距离，换算级别，这个时候是有一个对应关系的，并且是一个范围，比如3000万米以上显示地图的0级，3000万到2000万显示地图1级，2000万到1000万显示地图2级，此处数字只是示例，不是真实数字。知道了瓦片级别，加入需要计算当前的位置对应的瓦片行列号，比如首都(116.39,39.90)在第二级的行列号，为

>列号 = [取整(116.39+180)/(360/(2的级别次方))]=3
</br>行号 = [2的(级别-1)次方 - 取整(39.90+90)/(180/(2的级别次方))]